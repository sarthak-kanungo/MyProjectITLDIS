!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/forms"),require("rxjs/operators"),require("uuid"),require("@angular/common"),require("@angular/material"),require("@angular/material/select")):"function"==typeof define&&define.amd?define("editable-table",["exports","@angular/core","rxjs","@angular/forms","rxjs/operators","uuid","@angular/common","@angular/material","@angular/material/select"],t):t((e=e||self)["editable-table"]={},e.ng.core,e.rxjs,e.ng.forms,e.rxjs.operators,e.uuid,e.ng.common,e.ng.material,e.ng.material.select)}(this,(function(e,t,o,r,n,a,i,l,c){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(){return(s=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var u=function(){function e(){var e=this;this.sendColumnNameRecord$=new o.Subject,this.sendColumnRecord$=new o.Subject,this.validateTable$=new t.EventEmitter,this.getTableRecord$=new t.EventEmitter,this.getColumnNameToCollectColumnRecord$=new o.Observable((function(t){e.sendColumnNameRecord=t}))}return e.prototype.getColumnRecord=function(e){this.sendColumnNameRecord$.next(e)},e.prototype.getColumnNameToCollectColumnRecord=function(){var e=this;return new o.Observable((function(t){e.sendColumnNameRecord=t}))},e.prototype.emitColumnRecord=function(e,t){var o=this;setTimeout((function(){o.sendColumnRecord$.next({recordList:e,formControlName:t})}),1)},e.prototype.validateTable=function(){return this.validateTable$},e.prototype.getValidTableRecord=function(){return this.validateTable$.emit(!0),this.getTableRecord$},e.prototype.sendTableRecord=function(e){var t=this;setTimeout((function(){t.getTableRecord$.emit(e)}),100)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var m=function(){function e(){}return e.prototype.setValidators=function(e){},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var p=function(e,t,o,r){this.formControlName=e,this.tableRowId=t,this.msg=o,this.type=r,o||(this.isRemove=!0),Object.seal(this)};var f=function(){function e(e,r,n){var a=this;this.fb=e,this.etDataHandlerService=r,this._changeDetectorRef=n,this.filteredOptions={},this.selectOptions={},this.subscription=new o.Subscription,this.viewOnly=!1,this.hideActionBtn=!1,this.hideDefaultRow=!1,this.tableConfig=[],this.getTableRecordChange=new t.EventEmitter,this.optionSelected=new t.EventEmitter,this.searchValueChanges=new t.EventEmitter,this.tableValueChanges=new t.EventEmitter,this.deletedTableRecords=new t.EventEmitter,this.matAutocompleteDisplayFn=new o.Subject,this.onTouched=function(){a.editableTableForm.markAllAsTouched()}}return Object.defineProperty(e.prototype,"assignListToSelect",{set:function(e){var t=this;e&&e.forEach((function(e){t.selectOptions[e.formControlName]=e.list}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getFormData",{set:function(e){var t=this;e.subscribe((function(e){e&&t.getTableRecordChange.emit(t.editableTableForm.controls.table.getRawValue())}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assignListToAutocomplete",{set:function(e){e&&"autocomplete"===e.config.inputField&&(this.filteredOptions[e.config.formControlName]=this._filter(e.searchKey,e.list,e.config.displayKey))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"patchValue",{set:function(e){this._patchValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"patchValueToSelect",{set:function(e){if(e&&this.editableTableForm){var t=this.editableTableForm.controls.table;e.forEach((function(e){t.controls[e.rowIndex]&&t.controls[e.rowIndex].patchValue(e.patchValue)}))}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableData",{set:function(e){e&&e.length>0&&(this._tableData=e,this.createTableWithData(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formGroupForTableRow",{set:function(e){this._formGroupForTableRow=s({},e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validationError",{set:function(e){e&&(this._validationError=e,this.setError(e))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.createTableForm(),this.subscribeToSendColumnNameRecord(),this.subscribeToValidateTable(),this.assignMarkAsTouchedFnToControl(this.control)},e.prototype.ngOnChanges=function(e){e.patchValue&&e.patchValue.currentValue&&(this._patchValue=e.patchValue.currentValue,this.patchValueToTable(this._patchValue)),e.control&&e.control.currentValue&&this.assignMarkAsTouchedFnToControl(this.control)},e.prototype.assignMarkAsTouchedFnToControl=function(e){var t=this;e&&(e.markAsTouched=function(){t.editableTableForm.markAllAsTouched()})},e.prototype.patchValueToTable=function(e){if(e&&e.length>0){this.editableTableForm||this.createTableForm();var t,o=this.editableTableForm.controls.table;e.forEach((function(e){if(e.tableRowId)for(var r in o.value){if(o.value.hasOwnProperty(r))o.value[r].tableRowId===e.tableRowId&&(t=r)}(t=!t&&e.rowIndex?e.rowIndex:t)?o.controls[t].patchValue(e.patchValue):console.error("patch row undefined")}))}},e.prototype.createTableWithData=function(e){var t=this;if(this.editableTableForm){var o=this.editableTableForm.get("table");o.length>1&&o.clear(),e.forEach((function(e,r){0===r&&o.length>0?t.patchValueToTable([{rowIndex:"0",patchValue:e}]):t.addRow(e)}))}},e.prototype.subscribeToSendColumnNameRecord=function(){var e=this;this.etDataHandlerService.sendColumnNameRecord$.subscribe((function(t){if(!e.viewOnly){var o=e.editableTableForm.controls.table,r=[],n=o.getRawValue();if("all"!==t.toLowerCase())r=e.collectColumnRecord(n,t),e.etDataHandlerService.emitColumnRecord(r,t);else e.tableConfig.filter((function(e){return e.isNeedValueChanges})).forEach((function(t){r=e.collectColumnRecord(n,t.formControlName),e.etDataHandlerService.emitColumnRecord(r,t.formControlName)}))}}))},e.prototype.collectColumnRecord=function(e,t){var o=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];o.push(n[t])}return o},e.prototype.subscribeToValidateTable=function(){var e=this,t=this.etDataHandlerService.validateTable().subscribe((function(t){if(t){if(e.editableTableForm.markAllAsTouched(),"VALID"===e.editableTableForm.status||"DISABLED"===e.editableTableForm.status)return void e.etDataHandlerService.sendTableRecord({data:e.editableTableForm.controls.table.getRawValue(),valid:!0});e.etDataHandlerService.sendTableRecord({data:[],valid:!1})}}));this.subscription.add(t)},e.prototype.createTableForm=function(){this.editableTableForm||(this.etFormArray?this.editableTableForm=this.fb.group({table:this.etFormArray}):this.editableTableForm=this.fb.group({table:this.fb.array([])}),!this.hideDefaultRow&&0===this.editableTableForm.controls.table.length&&(this.tableConfig.length>0||this.etFormArray.length>0)&&this.addRow(),this.tableValueChanges.emit(this.editableTableForm.valueChanges),this._tableData&&this.createTableWithData(this._tableData))},e.prototype.implementsDetailsRow=function(e){var t=this,o=this.fb.group(this._formGroupForTableRow);return console.log("this._formGroupForTableRow: ",this._formGroupForTableRow),e&&!this.viewOnly&&o.patchValue(e),this.viewOnly&&(o.disable(),e&&o.patchValue(e,{onlySelf:!0,emitEvent:!1})),o.addControl("tableRowId",this.fb.control(a.v4())),console.log("fg: ",o),this.tableConfig.forEach((function(e){("autocomplete"===e.inputField||e.isNeedValueChanges)&&o.controls[e.formControlName].valueChanges.subscribe((function(r){t.searchValueChanges.emit({key:r,config:e,tableRow:o.getRawValue()}),t.dirtyAutocompleteColumn=s({},e)}))})),o},e.prototype._filter=function(e,t,o){var r;return e||""===e?t:("string"==typeof e&&(r=e.toLowerCase()),"object"==typeof e&&(r=e[o].toLowerCase()),t.filter((function(e){return 0===e[o].toLowerCase().indexOf(r)})))},e.prototype.submitData=function(){},e.prototype.addRow=function(e){if(this.etFormArray)this.editableTableForm.controls.table=this.etFormArray;else{var t=this.editableTableForm.controls.table;t.markAllAsTouched(),t.valid&&t.push(this.implementsDetailsRow(e))}},e.prototype.resetTable=function(e){var t=this.editableTableForm.controls.table;t.clear(),t.push(this.implementsDetailsRow(e))},e.prototype.deleteRow=function(){var e=this.editableTableForm.controls.table,t=[],o=e.controls.filter((function(e){return e.value.isSelected&&t.push(e.getRawValue()),!e.value.isSelected}));this.deletedTableRecords.emit(t),e.clear(),o.forEach((function(t){return e.push(t)}))},e.prototype.generateAutocompleteDisplayFn=function(e){var t=e.patchKey||e.displayKey;this.matAutocompleteDisplayFn.next((function(e){return e&&"object"==typeof e?e[t]:e})),this._changeDetectorRef.detectChanges()},e.prototype.autocompleteClicked=function(e,t){this.filteredOptions[e.formControlName]=[],this.generateAutocompleteDisplayFn(e),t.controls[e.formControlName].value&&(this.searchValueChanges.emit({key:t.controls[e.formControlName].value,config:e,tableRow:t.getRawValue()}),this.dirtyAutocompleteColumn=s({},e))},e.prototype.valueSelectedFromAutocomplete=function(e,t,o,r){var n=e&&"object"==typeof e.option.value?s({},e.option.value):e.option.value||"";this.optionSelected.emit(s({option:n},{rowIndex:t,tableRow:o.getRawValue(),config:r}))},e.prototype.selectionChanged=function(e){},e.prototype.contenteditableValuechange=function(e,t,o){t.controls[o].patchValue(e)},e.prototype.setError=function(e){var t=this.editableTableForm.get("table"),o=t.getRawValue().findIndex((function(t){if(t.tableRowId===e.tableRowId)return!0})),r=t.at(o);if(r){if(e.isRemove)return void r.get(e.formControlName).setErrors(null);r.get(e.formControlName).setErrors(s({msg:e.msg},e.type))}},e.prototype.writeValue=function(e){if(e&&e.resetForm)return this.editableTableForm.reset(),void this.resetTable();e&&e.length>0&&(this.tableData=e)},e.prototype.registerOnChange=function(e){var t=this;e&&this.editableTableForm.controls.table.valueChanges.pipe(n.map((function(e){return t.editableTableForm.controls.table.getRawValue()}))).subscribe(e)},e.prototype.registerOnTouched=function(e){e&&(this.onTouched=e)},e.prototype.setDisabledState=function(e){e?this.editableTableForm.controls.table.disable():this.editableTableForm.controls.table.enable()},e.prototype.validate=function(e){return this.editableTableForm.controls.table.valid?null:{invalidForm:{valid:!1,message:"editableTableForm fields are invalid"}}},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.decorators=[{type:t.Component,args:[{selector:"editable-table",template:'<div id="divshow">\n  <form [formGroup]="editableTableForm">\n    <div>\n      <div class="table-responsive">\n        <table class="table table-bordered table-sm" formArrayName="table">\n          <thead class="thead-light">\n            <tr>\n              <th scope="col" style="width: 10px;" *ngFor="let config of tableConfig" [class]="config.title">{{config.title}}</th>\n            </tr>\n          </thead>\n          <tbody>\n            <ng-container *ngFor="let rowFormGroup of editableTableForm[\'controls\'].table[\'controls\']; let i = index"\n              [formGroupName]="i">\n              <tr>\n                <ng-container *ngFor="let config of tableConfig">\n                  <td *ngIf="config.inputField !== \'contenteditable\'">\n                    <mat-checkbox *ngIf="config.inputField === \'checkbox\'" color="basic"\n                      class="form-control form-control-sm" [formControlName]="config.formControlName" [checked]="false">\n                    </mat-checkbox>\n                    <mat-form-field class="example-full-width" *ngIf="config.inputField === \'input\'"\n                      appearance="outline" [ngClass]="{pb_0:!rowFormGroup.get(config.formControlName).errors}">\n                      <input matInput [placeholder]="config.title" [formControlName]="config.formControlName">\n                      <mat-error\n                        *ngIf="rowFormGroup.get(config.formControlName).errors && rowFormGroup.get(config.formControlName).errors.msg &&!rowFormGroup.get(config.formControlName).errors.required">\n                        {{rowFormGroup.get(config.formControlName).errors.msg}}</mat-error>\n                      <mat-error\n                        *ngIf="rowFormGroup.get(config.formControlName).errors && !rowFormGroup.get(config.formControlName).errors.msg &&rowFormGroup.get(config.formControlName).errors.required">\n                        This field is required</mat-error>\n                    </mat-form-field>\n                    <mat-form-field *ngIf="config.inputField === \'autocomplete\'" class="w-100"\n                      [ngClass]="{pb_0:!rowFormGroup.get(config.formControlName).errors}" appearance="outline">\n                      <input matInput [formControlName]="config.formControlName" [matAutocomplete]="autoAmcNumber"\n                        (focus)="autocompleteClicked(config, rowFormGroup)" (keyup.enter)="$event.preventDefault();">\n                      \x3c!-- (blur)="resetFormControlNotHavingObject(searchAMCForm.controls.amcNumber, \'amcNumber\')" --\x3e\n                      <mat-autocomplete #autoAmcNumber="matAutocomplete"\n                        [displayWith]="matAutocompleteDisplayFn | async"\n                        (optionSelected)="valueSelectedFromAutocomplete($event, i, rowFormGroup, config)" [panelWidth]="500">\n                        <mat-option *ngFor="let option of filteredOptions[config.formControlName]" [value]="option">\n                          \x3c!-- (click)="valueSelectedFromAutocomplete(option)" --\x3e\n                          {{option[config.displayKey]? option[config.displayKey] : option}}\n                        </mat-option>\n                      </mat-autocomplete>\n                      <mat-icon matSuffix>search</mat-icon>\n                      <mat-error\n                        *ngIf="rowFormGroup.get(config.formControlName).errors && rowFormGroup.get(config.formControlName).errors.msg &&!rowFormGroup.get(config.formControlName).errors.required">\n                        {{rowFormGroup.get(config.formControlName).errors.msg}}</mat-error>\n                      <mat-error\n                        *ngIf="rowFormGroup.get(config.formControlName).errors && !rowFormGroup.get(config.formControlName).errors.msg &&rowFormGroup.get(config.formControlName).errors.required">\n                        This field is required</mat-error>\n                    </mat-form-field>\n                    \x3c!-- <span *ngIf="config.inputField === \'autocomplete\'">\n                      {{matAutocompleteDisplayFn | async}}\n                    </span> --\x3e\n                    <mat-form-field *ngIf="config.inputField === \'select\'" appearance="outline" class="pb_0">\n                      <mat-label>Select {{config.title}}</mat-label>\n                      <mat-select [formControlName]="config.formControlName"\n                        (selectionChange)="selectionChanged($event)">\n                        <mat-option *ngFor="let option of selectOptions[config.formControlName]" [value]="option">\n                          {{option[config.displayKey]? option[config.displayKey] : option}}\n                        </mat-option>\n                      </mat-select>\n                      <mat-error\n                      *ngIf="rowFormGroup.get(config.formControlName).errors && rowFormGroup.get(config.formControlName).errors.msg &&!rowFormGroup.get(config.formControlName).errors.required">\n                      {{rowFormGroup.get(config.formControlName).errors.msg}}</mat-error>\n                      <mat-error\n                        *ngIf="rowFormGroup.get(config.formControlName).errors && !rowFormGroup.get(config.formControlName).errors.msg &&rowFormGroup.get(config.formControlName).errors.required">\n                        This field is required</mat-error>\n                    </mat-form-field>\n                  </td>\n                  <td *ngIf="config.inputField === \'contenteditable\'"\n                    [attr.contenteditable]="config.inputField !== \'contenteditable\' || config.isNeedValueChanges"\n                    [textContent]="rowFormGroup.controls[config.formControlName].value"\n                    (input)="contenteditableValuechange($event.target.textContent,rowFormGroup,config.formControlName)"\n                    #contenteditableRef></td>\n                </ng-container>\n              </tr>\n              \x3c!-- <ng-content select="tr"></ng-content> --\x3e\n            </ng-container>\n          </tbody>\n          <tfoot>\n            <ng-content select="ng-container.table_footer"></ng-content>\n          </tfoot>\n        </table>\n      </div>\n    </div>\n  </form>\n  <div class=" text-center mt-2" *ngIf="!hideActionBtn && !viewOnly ">\n    <button type="button" class="btn btn-sm btn_primary " (click)="addRow()"> Add\n      Row</button>\n    <button type="button" class="btn btn-sm btn_secondary ml-2 " (click)="deleteRow()"> Delete Row </button>\n  </div>\n</div>',providers:[{provide:r.NG_VALUE_ACCESSOR,useExisting:t.forwardRef((function(){return e})),multi:!0},{provide:r.NG_VALIDATORS,useExisting:t.forwardRef((function(){return e})),multi:!0}],styles:[""]}]}],e.ctorParameters=function(){return[{type:r.FormBuilder},{type:u},{type:t.ChangeDetectorRef}]},e.propDecorators={viewOnly:[{type:t.Input}],hideActionBtn:[{type:t.Input}],hideDefaultRow:[{type:t.Input}],assignListToSelect:[{type:t.Input}],tableConfig:[{type:t.Input}],getFormData:[{type:t.Input}],getTableRecordChange:[{type:t.Output}],optionSelected:[{type:t.Output}],assignListToAutocomplete:[{type:t.Input}],patchValue:[{type:t.Input}],patchValueToSelect:[{type:t.Input}],tableData:[{type:t.Input,args:["tableData"]}],searchValueChanges:[{type:t.Output}],tableValueChanges:[{type:t.Output}],formGroupForTableRow:[{type:t.Input}],deletedTableRecords:[{type:t.Output}],matAutocompleteDisplayFn:[{type:t.Input}],etFormArray:[{type:t.Input}],control:[{type:t.Input}],validationError:[{type:t.Input}]},e}();var d=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[f],imports:[i.CommonModule,r.FormsModule,r.ReactiveFormsModule,l.MatCheckboxModule,l.MatAutocompleteModule,l.MatFormFieldModule,l.MatInputModule,l.MatIconModule,c.MatSelectModule],exports:[f]}]}],e}();e.ETValidationError=p,e.EditableTableComponent=f,e.EditableTableModule=d,e.EtDataHandlerService=u,e.EtFormHandlerService=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=editable-table.umd.min.js.map