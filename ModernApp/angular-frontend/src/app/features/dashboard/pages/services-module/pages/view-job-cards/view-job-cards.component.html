<div class="job-card-view-container">
    <div class="breadcrumb-bar">
        SERVICE <span class="separator">▶</span> VIEW ALL JOB CARD
    </div>

    <div class="card-header-bar">
        VIEW ALL JOB CARD
    </div>

    <div class="filters-container">
        <div class="filter-row">
            <div class="radio-group">
                <label>
                    <input type="radio" name="searchType" value="jobCardNo" [(ngModel)]="searchColumn"> Job Card No.
                </label>
                <label>
                    <input type="radio" name="searchType" value="vinNo" [(ngModel)]="searchColumn"> Chassis No.
                </label>
                <label>
                    <input type="radio" name="searchType" value="mobilePhone" [(ngModel)]="searchColumn"> Contact No.
                </label>
            </div>

            <input type="text" class="search-input" [(ngModel)]="searchValue" placeholder="">

            <div class="status-group">
                <label>Status</label>
                <select [(ngModel)]="selectedStatus">
                    <option value="ALL">ALL</option>
                    <option value="OPEN">OPEN</option>
                    <option value="CLOSED">CLOSED</option>
                    <option value="PENDING">PENDING</option>
                    <option value="APPROVED">APPROVED</option>
                    <option value="REJECTED">REJECTED</option>
                </select>
            </div>

            <div class="date-check-group">
                <label>
                    <input type="checkbox" [(ngModel)]="useDateRange"> Tractor In Date
                </label>
            </div>

            <div class="date-group">
                <input type="text" placeholder="dd/mm/yyyy" [(ngModel)]="fromDate" [disabled]="!useDateRange"
                    class="date-input">
                <label class="to-label">To</label>
                <input type="text" placeholder="dd/mm/yyyy" [(ngModel)]="toDate" [disabled]="!useDateRange"
                    class="date-input">
            </div>

            <button class="search-btn" (click)="fetchJobCards()">SEARCH</button>
        </div>
    </div>

    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th width="5%" class="center-align">S No.</th>

                    <th width="20%" (click)="sort('jobCardNo')" class="sortable">
                        <div class="th-content">
                            <span class="col-title">Job Card No. <span *ngIf="sortColumn === 'jobCardNo'">{{
                                    sortDirection === 'asc' ? '▲' : '▼' }}</span></span>
                            <mat-icon class="search-icon" (click)="toggleFilter('jobCardNo', $event)">search</mat-icon>
                        </div>
                        <div class="filter-popup" *ngIf="visibleFilters['jobCardNo']"
                            (click)="$event.stopPropagation()">
                            <input type="text" class="filter-input" [value]="filterValues['jobCardNo']"
                                (keyup)="applyFilter($event, 'jobCardNo')" placeholder="Search Job Card...">
                        </div>
                    </th>

                    <th width="20%" (click)="sort('vinNo')" class="sortable">
                        <div class="th-content">
                            <span class="col-title">Chassis No. <span *ngIf="sortColumn === 'vinNo'">{{ sortDirection
                                    === 'asc' ? '▲' : '▼' }}</span></span>
                            <mat-icon class="search-icon" (click)="toggleFilter('vinNo', $event)">search</mat-icon>
                        </div>
                        <div class="filter-popup" *ngIf="visibleFilters['vinNo']" (click)="$event.stopPropagation()">
                            <input type="text" class="filter-input" [value]="filterValues['vinNo']"
                                (keyup)="applyFilter($event, 'vinNo')" placeholder="Search Chassis...">
                        </div>
                    </th>

                    <th width="15%" (click)="sort('jobCardDate')" class="sortable center-align">
                        <div class="th-content center-content">
                            <span class="col-title">Tractor In Date <span *ngIf="sortColumn === 'jobCardDate'">{{
                                    sortDirection === 'asc' ? '▲' : '▼' }}</span></span>
                            <mat-icon class="search-icon"
                                (click)="toggleFilter('jobCardDate', $event)">search</mat-icon>
                        </div>
                        <div class="filter-popup" *ngIf="visibleFilters['jobCardDate']"
                            (click)="$event.stopPropagation()">
                            <input type="text" class="filter-input" [value]="filterValues['jobCardDate']"
                                (keyup)="applyFilter($event, 'jobCardDate')" placeholder="Search Date...">
                        </div>
                    </th>

                    <th width="20%" (click)="sort('payeeName')" class="sortable">
                        <div class="th-content">
                            <span class="col-title">Payee Name <span *ngIf="sortColumn === 'payeeName'">{{ sortDirection
                                    === 'asc' ? '▲' : '▼' }}</span></span>
                            <mat-icon class="search-icon" (click)="toggleFilter('payeeName', $event)">search</mat-icon>
                        </div>
                        <div class="filter-popup" *ngIf="visibleFilters['payeeName']"
                            (click)="$event.stopPropagation()">
                            <input type="text" class="filter-input" [value]="filterValues['payeeName']"
                                (keyup)="applyFilter($event, 'payeeName')" placeholder="Search Payee...">
                        </div>
                    </th>

                    <th width="10%" (click)="sort('mobilePhone')" class="sortable">
                        <div class="th-content">
                            <span class="col-title">Contact No. <span *ngIf="sortColumn === 'mobilePhone'">{{
                                    sortDirection === 'asc' ? '▲' : '▼' }}</span></span>
                            <mat-icon class="search-icon"
                                (click)="toggleFilter('mobilePhone', $event)">search</mat-icon>
                        </div>
                        <div class="filter-popup" *ngIf="visibleFilters['mobilePhone']"
                            (click)="$event.stopPropagation()">
                            <input type="text" class="filter-input" [value]="filterValues['mobilePhone']"
                                (keyup)="applyFilter($event, 'mobilePhone')" placeholder="Search Contact...">
                        </div>
                    </th>

                    <th width="10%" (click)="sort('status')" class="sortable center-align">
                        <div class="th-content center-content">
                            <span class="col-title">Status <span *ngIf="sortColumn === 'status'">{{ sortDirection ===
                                    'asc' ? '▲' : '▼' }}</span></span>
                            <mat-icon class="search-icon" (click)="toggleFilter('status', $event)">search</mat-icon>
                        </div>
                        <div class="filter-popup" *ngIf="visibleFilters['status']" (click)="$event.stopPropagation()">
                            <input type="text" class="filter-input" [value]="filterValues['status']"
                                (keyup)="applyFilter($event, 'status')" placeholder="Search Status...">
                        </div>
                    </th>

                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let card of filteredJobCards; let i = index">
                    <td class="center-align">{{ getSerialNumber(i) }}</td>
                    <td><a href="javascript:void(0)" (click)="viewJobCard(card.jobCardNo)">{{ card.jobCardNo }}</a></td>
                    <td>{{ card.vinNo }}</td>
                    <td class="center-align">{{ card.jobCardDate }}</td>
                    <td>{{ card.payeeName }}</td>
                    <td>{{ card.mobilePhone }}</td>
                    <td class="center-align">{{ card.status }}</td>
                </tr>
                <tr *ngIf="filteredJobCards.length === 0">
                    <td colspan="7" class="no-records">No records found.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="custom-paginator" *ngIf="totalElements > 0">
        <a href="javascript:void(0)" (click)="goToPage(0)" [class.disabled]="currentPage === 0" title="First">
            <mat-icon class="pager-icon">first_page</mat-icon>
        </a>
        <a href="javascript:void(0)" (click)="goToPage(currentPage - 1)" [class.disabled]="currentPage === 0"
            title="Previous" *ngIf="currentPage > 0">
            <mat-icon class="pager-icon">navigate_before</mat-icon>
        </a>

        <ng-container *ngFor="let p of getPageNumbers()">
            <a href="javascript:void(0)" (click)="goToPage(p)" class="page-number" [class.active]="p === currentPage">{{
                p + 1 }}</a>
        </ng-container>

        <a href="javascript:void(0)" (click)="goToPage(currentPage + 1)"
            [class.disabled]="currentPage >= getTotalPages() - 1" title="Next">
            <mat-icon class="pager-icon">navigate_next</mat-icon>
        </a>
        <a href="javascript:void(0)" (click)="goToPage(getTotalPages() - 1)"
            [class.disabled]="currentPage >= getTotalPages() - 1" title="Last">
            <mat-icon class="pager-icon">last_page</mat-icon>
        </a>
    </div>
</div>