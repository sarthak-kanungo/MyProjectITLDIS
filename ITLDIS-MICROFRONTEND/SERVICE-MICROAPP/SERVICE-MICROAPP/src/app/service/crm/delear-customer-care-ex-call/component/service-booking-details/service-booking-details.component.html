<div class = "card-from mt-2" *ngIf="!isView">
    <div class = "card">
        <div class="card-header">
            <p class="mb-0">Machines Pending For Service</p>
        </div>
        <div class = "class-body">
            <div class="mt-2">

                <div class="card-body" [formGroup]="bookingSearchForm" [style.fontSize.px]="11">
                    <div class="row">

                        <div class="col-lg-2">
                            <mat-form-field class="w-100" appearance="outline">
                                <mat-label>Chassis No.</mat-label>
                                <input matInput placeholder="Chassis No." [matAutocomplete]="auto2" formControlName="chassisNo">                                                              
                                <mat-autocomplete [panelWidth]="500" #auto2="matAutocomplete">
                                    <mat-option *ngFor="let option of chassisData" [value]="option.chassisNumber">
                                        {{option.chassisNumber}}
                                        </mat-option>
                                </mat-autocomplete>
                                <mat-icon matSuffix>search</mat-icon>  
                            </mat-form-field>
                        </div>  
                        
                        <div class="col-lg-2">
                            <mat-form-field class="w-100" appearance="outline">
                                <mat-label>Customer Mobile No.</mat-label>
                                <input matInput placeholder="Customer Mobile No." formControlName="mobileNo" inputmode="numeric" 
                                 [matAutocomplete]="automobileNo" minlength="10" maxlength="10">
                                <mat-autocomplete #automobileNo="matAutocomplete" [panelWidth]="150">
                                    <mat-option *ngFor="let option of customerMobileList " [value]="option.mobileNumber">
                                        {{option?.mobileNumber}}
                                    </mat-option>
                                </mat-autocomplete>
                                <mat-icon matSuffix>search</mat-icon>
                            </mat-form-field>
                        </div>

                        <div class="col-lg-2">
                            <mat-form-field class="w-100" appearance="outline">
                                <mat-label>Customer Name</mat-label>
                                <input matInput placeholder="Customer Name" formControlName="customerName"  
                                 [matAutocomplete]="autoCustName" >
                                <mat-autocomplete #autoCustName="matAutocomplete" [panelWidth]="200">
                                    <mat-option *ngFor="let option of customerNameList " [value]="option.customerName">
                                        {{option?.customerName}}
                                    </mat-option>
                                </mat-autocomplete>
                                <mat-icon matSuffix>search</mat-icon>
                            </mat-form-field>
                        </div>

                        <div class="col-lg-2">
                            <mat-form-field class="w-100" appearance="outline">
                                <mat-label>Current Service Due Type</mat-label>
                                <input matInput placeholder="Current Service Due Type" formControlName="currentServiceDueType"  
                                 [matAutocomplete]="autoDueType" >
                                <mat-autocomplete #autoDueType="matAutocomplete" [panelWidth]="190">
                                    <mat-option *ngFor="let option of dueTypeList " [value]="option.currentServiceDueType">
                                        {{option?.currentServiceDueType}}
                                    </mat-option>
                                </mat-autocomplete>
                                <mat-icon matSuffix>search</mat-icon>
                            </mat-form-field>
                        </div>

                        

                        <div class="col-lg-2">
                            <mat-form-field class="w-100 pb_0" appearance="outline">
                                <mat-label>Current Service Due Date</mat-label>
                                <input matInput [matDatepicker]="picker" placeholder="Current Service Due Date"  formControlName="currentServiceDueDate">
                                    <!-- (dateChange)="dateSelectionChange($event)" -->
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                        </div>

                        <div class="text-center  ml-4 mb-2">
                            <button type="button" class="btn  btn_primary px-3" (click)="searchTable()">
                                Search
                            </button>
                            <button type="button" class="btn  btn_secondary px-3 ml-2" (click)="clearSearchFields()">
                                Clear
                            </button>
                        </div>

                    </div>
                </div>

                
                <div class="mt-1">
                    <div id="container">
                        <div id="content">          

                        <ngsw-search-table  [dataTable]="dataTable" [totalElements]="totalTableElements"
                        (pageChange)="pageSizeChange($event)"  [searchValue]="searchValue" 
                        [clickOnTableFields]="[{title:'action'}]" (actionOnTableRecord)="tableAction($event)">
                        
                        </ngsw-search-table>

                        </div>
                    </div>
                </div>              

            </div>
        </div>
    </div>
</div>

<div class="card-from mt-2" id="serviceBookingId" *ngIf="viewServiceBooking || (showServiceBookingForm&& !hideSubmitButton)">
    <div class="card">
        <div class="card-header">
            <p class="mb-0">Service Booking Details</p>
        </div>
        <div class="card-body">
            <form action="" [formGroup]="bookingDetailsBasicForm" [style.fontSize.px]="11">
                <div class="row">
                    <div class="col-lg-2" *ngIf="isCreate">
                        <mat-form-field appearance="outline">
                            <mat-label>Chassis No.</mat-label>
                            <input matInput placeholder="Chassis No." formControlName="chassisNo">
                        </mat-form-field>
                    </div>
                   
                    <div class="col-lg-2" *ngIf="isView">
                        <mat-form-field appearance="outline">
                            <mat-label>Chassis No</mat-label>
                            <input matInput placeholder="Chassis No" formControlName="chassisNo">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Booking Date</mat-label>
                            <input matInput [matDatepicker]="picker" placeholder="Booking Date" formControlName="bookingDate">
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2" *ngIf="isView || isEdit">
                        <mat-form-field appearance="outline">
                            <mat-label>Status</mat-label>
                            <input matInput placeholder="Status" formControlName="status">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Mechanic</mat-label>
                            <mat-select formControlName="mechanic" [compareWith]="compareFnMechanic">
                                <mat-option *ngFor="let mechanic of mechanicName" [value]="mechanic">{{mechanic.name}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="bookingDetailsBasicForm.get('mechanic').hasError('required')">
                                Mechanic is Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Customer Name</mat-label>
                            <input matInput placeholder="Customer Name" formControlName="customerName">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Engine No.</mat-label>
                            <input matInput placeholder="Engine No." formControlName="engineNo">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Machine Model</mat-label>
                            <input matInput placeholder="Machine Model" formControlName="model">
                        </mat-form-field>
                    </div>
                    
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Source of Booking</mat-label>
                            <mat-select formControlName="sourceOfBooking" [compareWith]="compareFnSourceofBooking">
                                <mat-option *ngFor="let source of sourceofBooking" [value]="source">{{source.sourceOfBooking}}
                                </mat-option>
                                
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Current Hours</mat-label>
                            <input matInput class="quantity" placeholder="Current Hours"
                                formControlName="currentHour" (keypress)="validateNumber($event)" (blur)="onBlurCurrentHours($event)">
                            <mat-error *ngIf="bookingDetailsBasicForm.get('currentHour').hasError('required')">
                                <strong> Current Hours Required</strong>
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Previous Hours</mat-label>
                            <input matInput class="quantity" type="number" placeholder="Previous Hours"
                                formControlName="previousHour">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Total Hours</mat-label>
                            <input matInput class="quantity" type="number" placeholder="Total Hours" formControlName="totalHour">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Service Category</mat-label>
                            <mat-select formControlName="serviceCategory" [compareWith]="compareFnServiceCategory"
                                (selectionChange)="selectionServiceCategory($event)">
                                <mat-option *ngFor="let category of serviceCategory" [value]="category">
                                    {{category.category}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="bookingDetailsBasicForm.get('serviceCategory').hasError('required')">
                                Service Category is Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2" *ngIf="isCreate">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Service Type</mat-label>
                            <mat-select formControlName="serviceMtServiceTypeInfo" [compareWith]="compareFnServiceType">
                                <mat-option *ngFor="let option of serviceType" [value]="option">
                                    {{option.serviceType}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="bookingDetailsBasicForm.get('serviceMtServiceTypeInfo').hasError('required')">
                                Service Type is Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2" *ngIf="isView">
                        <mat-form-field appearance="outline">
                            <mat-label>Service Type</mat-label>
                            <input matInput  placeholder="Service Type" formControlName="serviceMtServiceTypeInfo">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Place of Service</mat-label>
                            <mat-select formControlName="placeOfService" (selectionChange)="selectionPlaceofService($event)"
                                [compareWith]="compareFnPlaceofService">
                                <mat-option *ngFor="let option of placeOfService" [value]="option">
                                    {{option.placeOfService}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="bookingDetailsBasicForm.get('placeOfService').hasError('required')">
                                Place of Service is Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field class="w-100">
                            <input matInput  [matDatepicker]="picker2" [min]="maxDate"  placeholder="Appointment Date"
                                formControlName="appointmentDate" readonly (click)="picker2.open()">
                            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                            <mat-datepicker #picker2></mat-datepicker>
                            <mat-error *ngIf="bookingDetailsBasicForm.get('appointmentDate').hasError('required')">
                                Appointment Date is Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Appointment Time</mat-label>
                            <input type="time" matInput placeholder="Appointment Time" formControlName="appointmentTime">
                            <mat-error *ngIf="bookingDetailsBasicForm.get('appointmentDate').hasError('required')">
                                Appointment Time is Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2" *ngIf="isPlaceOfService">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Activity/Event Type</mat-label>
                            <mat-select formControlName="activityType" (selectionChange)="activityChanged($event)"
                                [compareWith]="compareFnActivityType">
                                <mat-option *ngFor="let option of activityType" [value]="option">
                                    {{option?.activityType}}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="bookingDetailsBasicForm.get('activityType').hasError('required')">
                                Activity Type is Required</mat-error>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2" *ngIf="isPlaceOfService">
                        <mat-form-field class="w-100" appearance="outline">
                            <mat-label>Activity No.</mat-label>
                            <input matInput placeholder="Activity No." formControlName="activityNo"
                                [matAutocomplete]="autoActivityNo">
                            <mat-autocomplete #autoActivityNo="matAutocomplete" [panelWidth]="500"
                                [displayWith]="displayFnActivityNo">
                                <mat-option *ngFor="let option of (activityNoList$ | async)" [value]="option">
                                    {{option?.value}}
                                </mat-option>
                            </mat-autocomplete>
                            <mat-error *ngIf="bookingDetailsBasicForm.get('activityNo').hasError('required')">
                                Activity No is Required</mat-error>
                            <mat-icon matSuffix>search</mat-icon>
                        </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field appearance="outline">
                            <mat-label>Registration No.</mat-label>
                            <input matInput placeholder="Registration No." formControlName="registrationNumber">
                        </mat-form-field>
                    </div>
                    <div class="col-lg-12">
                        <mat-form-field appearance="outline">
                            <mat-label>Remarks</mat-label>
                            <textarea matInput placeholder="Remarks" formControlName="remarks"></textarea>
                        </mat-form-field>
                    </div>
                </div>
            </form>
        </div>

    </div>

</div>



<div class="card-from mt-2" *ngIf="showServiceBookingForm">
    <div class="card">
        <div class="card-header">
            <p class="mb-0">Call History</p>
        </div>
        <div class="card-body">

            <div class="card-from">
                <div class="card">


                    <div class="card-body">
                        <div class="table-responsive">
                            <div class="row">
                                <div class="col-md-12">
                                    <table class="table table-bordered table-sm">
                                        <thead class="thead-light">
                                            <tr>
                                                <!-- <th class="p-2">SR NO.</th> -->

                                                <th class="p-2">Call Status</th>

                                                <th class="p-2">Call Type</th>
                                                <th class="p-2">Last Contacted Date
                                                </th>
                                                <th class="p-2">Attended CCE Employee Code
                                                </th>
                                                <th class="p-2">Attended CCE Employee Name

                                                </th>
                                                <th class="p-2">Customer Name

                                                </th>
                                                <th class="p-2">Customer Phone Number

                                                </th>
                                                <th class="p-2">Customer Address

                                                </th>
                                                <th class="p-2">Model

                                                </th>
                                                <th class="p-2">Final Status


                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            

                                            <tr  *ngFor="let option of historyDataServiceBooking; let i = index;">
                                                <!-- <td>{{i+1}}</td> -->
                                               
                                                 <td>{{option.callStatus}}</td>
                                                 <td>{{option.typeOfCall}}</td>
                                                 
                                                 <td>{{option.lastContactedDate | date:"MM/dd/yy"}}</td>
                                                 <td>{{option.empCode}}</td>
                                                 <td>{{option.attendedCCEEmpName}}</td>
                                                 <td>{{option.customerName}}</td>
                                                 <td>{{option.mobileNo}}</td>
                                                 <td>{{option.custAddress}}</td>
                                                 <td>{{option.model}}
                                                <td>{{option.finalStatus}}</td>
                                        </tbody>
                                    </table>
                                </div>

                            </div>

                        </div>
                    </div>
                    <!-- </div> -->
                </div>
            </div>

        </div>
    </div>
</div>

